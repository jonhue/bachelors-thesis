% !TeX root = ../main.tex
% Add the above to each chapter to make compiling the PDF easier in some editors.

\chapter{Introduction}\label{chapter:introduction}

\section{Motivation}

The energy use of data centers is estimated to account for between 1\% and 3\% of the global electricity supply and up to 1\% of global greenhouse gas emissions \cite{Shehabi2016, Jones2018, Bashroush2020, Masanet2020}. It is also estimated that energy use will dramatically increase over the next decades unless there are significant advances in energy efficiency \cite{Jones2018}. But energy conservation in data centers is not just important for ecological reasons. As the energy cost of data centers represents a notable fraction of its overall expenses, increasing the energy efficiency of a data center also has the potential to significantly reduce cost \cite{Barroso2007, Brill2007, Hamilton2008}.

In practice, the energy consumption of many data centers is largely decoupled from their load. Often, \textit{peak-provisioning} is used in the design of data centers to prevent a lack of resources during periods of high loads \cite{Whitney2014}. Due this over-provisioning and the absence of dynamic right-sizing, servers typically operate at utilization levels between 12\% and 18\% \cite{Whitney2014}. Other studies find an average utilization between 20\% and 40\% \cite{Barroso2007, Armbrust2010}.

It was shown that servers reach their peak efficiency at full utilization. At the typical levels of utilization, the energy efficiency of a server is between 20\% and 30\% \cite{Barroso2007}. Even when idling, servers consume half of their peak power \cite{Barroso2007}. A main research goal has therefore been to couple the energy consumption of a data center with its workload. In other words, to achieve \textit{power-proportionality} of a data center. The approach we investigate is to dynamically power-up and power-down servers as the load of a data center or a network of data centers changes. Solutions to this approach are also known as \textit{Power-Down Mechanisms} \cite{Jin2016}.

It is natural to model this problem as an optimization minimizing some metric of cost reflecting the energy consumption of a data center. Commonly, two variations of such optimization problems are considered. The \textit{online} variant receives a sequence of requests and performs an immediate action in response to each request. In contrast, the \textit{offline} variant receives all requests upfront and only responds once \cite{Karp1992}. It is easy to see that any solution to an online problem is at best as good as the solution to its offline variant.

\paragraph{Smoothed Online Convex Optimization} The models that we investigate are generalizations of Online Convex Optimization. In \textit{Online Convex Optimization}, an agent interacts with their environment in a sequence of rounds. In each round, the agent is presented with a convex cost function (in the following called \textit{hitting cost}). Based on this cost function the agent chooses where to move in a given decision space. The agent's goal is to minimize cost over a long time horizon \cite{Hazan2019}. In the context of right-sizing data centers it is apparent that we can use the hitting costs to model the energy consumption of active servers and possible delay incurred by having an inadequate number of active servers for some incoming load.

However, in some cases it is cheaper to keep a server in an idle state for a short period of time as powering up and powering down servers increases energy consumption and incurs wear-and-tear costs \cite{Lin2011}. We therefore generalize Online Convex Optimization by introducing a known \textit{switching cost} that penalizes the agent for movement in the decision space. This generalization is commonly called \textit{Smoothed Online Convex Optimization}. We also examine variants of this problem that further restrict the class of allowed convex cost functions, the switching cost or the decision space based on common modeling choices for right-sizing data centers.

\paragraph{Variants of Smoothed Online Convex Optimization} There are three main differentiators between the algorithms we consider in this work. First, we examine both offline and online algorithms. While only the latter are of immediate practical use we use the former as a benchmark. Second, we consider both fractional and integral versions of this problem. In principal, only integral versions solve the right-sizing problem of data centers but typically the number of servers in a data center is large enough to warrant the use of fractional versions \cite{Bansal2015}. Third, we differentiate between uni-dimensional and multi-dimensional versions of the problem. Initially, the right-sizing problem of data centers was proposed for homogeneous data centers \cite{Lin2011, Bansal2015, Albers2018}. In a homogeneous data center all servers share the same performance metrics, i.e. are of the same type. In more recent works, the problem was extended to heterogeneous data centers which may employ many different types of servers \cite{Lin2012, Chen2018, Goel2019, Albers2021, Albers2021_2}.

\paragraph{Competitive Ratio and Regret} The two main performance metrics used to analyze algorithms for Smoothed Online Convex Optimization are the competitive ratio and regret. These different performance metrics arise from two separate communities in which Online Convex Optimization problems often appear. In the context of online learning, algorithms aim to minimize regret (or often to achieve sublinear regret). \textit{Regret} is the difference between the loss achieved by the algorithm and the loss of the best fixed point in hindsight \cite{Chen2018}. In contrast, in the context of online algorithms, the aim is to minimize the competitive ratio (or often to achieve a constant competitive ratio). The \textit{competitive ratio} is defined analogously to the approximation ratio as the ratio of the loss achieved by the online algorithm and the loss achieved by an optimal offline algorithm \cite{Chen2018}. Note that in contrast to the definition of regret, the optimal solution may move in the decision space. We use both notions in our analysis and give formal definitions of the competitive ratio, regret, and alterations in \autoref{section:theory:performance_metrics}. Due to the use of two distinct metrics, some recent research is focused on finding unified frameworks to construct algorithms that perform well with regard to both notions of performance \cite{Chen2018, Goel2019}.

\paragraph{Convex Body Chasing} In the literature, Smoothed Online Convex Optimization is also known as \textit{Convex Function Chasing}. A related problem to Convex Function Chasing is the problem of \textit{Convex Body Chasing}. In Convex Body Chasing, requests consist of a convex set instead of a convex function. The agent is then required to choose a point in the convex set so as to minimize their movement \cite{Antoniadis2016}. Convex Body Chasing can be reduced to Convex Function chasing by considering for any convex set $K$ the function $f^K$ which is 0 on $K$ and $\infty$ off of $K$ \cite{Sellke2019}. In contrast, it was conjectured by \citeauthor*{Antoniadis2016} that Convex Function Chasing can also be reduced to Convex Body Chasing \cite{Antoniadis2016}. However, their initial proof based on a reduction from chasing hyperplanes was later retracted \cite{Pruhs2021}. A large body of recent work seeks to find algorithms with dimension-free bounds for related subproblems \cite{Bubeck2018, Bubeck2018_2, Argue2019, Argue2020}.

\paragraph{Predictions} It was shown that to achieve a constant competitive ratio for Smoothed Online Convex Optimization one must either restrict the class of allowed convex cost functions or switching costs \cite{Chen2018}. Moreover, even for linear cost functions no algorithm can achieve sublinear regret and a constant competitive ratio \cite{Andrew2015}. These results motivated another body of research that makes use of predictions to bypass this fundamental limitation. It is only natural to attempt using predictions for right-sizing data centers as there is usually is a large collection of server traces to base predictions on. There also has been much recent work improving the accuracy of time-series predictions \cite{Taylor2017, Benidis2020, Chen2020, Hosseini2021}. Interestingly, the performance of such predictions in the context of right-sizing data centers has not been studied in much detail. Most of the previous work was focused on finding algorithms based on \textit{Model Predictive Control} methods that use perfect predictions in some finite \textit{prediction window} \cite{Lin2012, Chen2015, Badiei2015, Chen2016, Li2018, Lin2019}. We investigate how these algorithms perform compared to an algorithm that considers the noise distributions of the predictions. [TODO: add results]

\section{Outline}

In this work, we investigate algorithms for Smoothed Convex Optimization and specifications thereof. We then examine the performance of these algorithms in the application of right-sizing data centers based on real server traces. Over the past decade many algorithms following a variety of different approaches were introduced. One of our main goals in this work is thus to determine which algorithms perform best in which scenarios. We also determine the overall cost- and energy saving potential of dynamically right-sizing data centers.

We begin in \autoref{chapter:application} by modeling the cost associated with operating data centers. In \autoref{chapter:theory}, we first introduce commonly used performance metrics in algorithm design. We then formally introduce Smoothed Convex Optimization and its variants that we consider in this work. We also show that Smoothed Convex Optimization and a more restricted variant are NP-hard when the dimension is allowed to vary. In chapters \ref{chapter:offline_algorithms} and \ref{chapter:online_algorithms} we introduce offline and online algorithms, respectively. In each chapter we begin with algorithms solving the uni-dimensional problem and then generalize some of these algorithms as well as introduce new approaches for the multi-dimensional setting. We end \autoref{chapter:online_algorithms} by examining algorithms that use predictions to make more informed decisions. In \autoref{chapter:experiments} we evaluate the performance of the discussed algorithms in the application of right-sizing data centers. We begin by discussing important features of the implementation, how the algorithms may be used in practice, and how our results can be reproduced. We then use real server traces to test algorithms solving the homogeneous and the heterogeneous right-sizing problem, respectively. In \autoref{chapter:conclusion} we summarize our conclusions and reference important questions for future research.

\section{Related Work}

In this section we reference two related bodies of research. First, we discuss alternatives to the approach of using Power-Down Mechanisms used in this work to increase the energy efficiency of data centers. Second, we examine other areas of application that have been shown to benefit from the use of techniques from Smoothed Online Convex Optimization. The implementation of the algorithms discussed in this work are generic and publicly available \cite{Hübotter2021}. It is therefore an interesting open question how these algorithms perform in practice in the applications referenced here.

\paragraph{Alternatives to Power-Down Mechanisms} As was mentioned previously, power-down mechanisms are just one approach to increasing the energy efficiency of data centers. Another widely studied approach is to lower the frequency/speed of devices to save energy. This approach is known as \textit{Dynamic Speed Scaling} or Dynamic Voltage and Frequency Scaling. Usually, Dynamic Speed Scaling seeks to determine the optimal processing speeds and job assignments to minimize energy usage and meet specified performance constraints (like job deadlines) \cite{Albers2007, Albers2011, Jin2016}. There is also a large body of research considering hybrid approaches that scale device speeds as well as power-down devices \cite{Jin2016}. The hybrid problem is also known as \textit{Speed Scaling with a Sleep State} \cite{Albers2014}. Other work has focused on so-called \textit{Machine Activation} problems where a subset of servers is selected according to a fixed cost budget so as to minimize the makespan of a set of jobs \cite{Khuller2009, Li2011}.

\paragraph{Other Applications of Smoothed Online Convex Optimization} Integral Smoothed Online Convex Optimization is subsumed by the class of problems known as \textit{Metrical Task Systems}. A Metrical Task System consists of a finite metric decision space, a switching cost and a sequence of hitting costs \cite{Bubeck2018_3}. Metrical Task Systems are more general than Smoothed Online Convex Optimization as the decision space is not required to be embedded in $\mathbb{Z}$, the hitting costs do not need to be convex, and the switching costs are not necessarily a norm. A prominent instance of Metrical Task Systems is the \textit{$k$-server problem} \cite{Bubeck2017}.

Any online convex optimization problem where, in reality, some cost is associated with taking an action, can be interpreted as a smoothed convex optimization. This is the case for many typical online convex optimization problems. The consideration of this switching cost, however, makes the problem more challenging as the optimal choice in each round depends on future cost functions \cite{Chen2015}. Therefore, switching costs are sometimes disregarded to simplify the algorithm design. Such problems are

\begin{itemize}
    \item \textit{video streaming} where the encoding quality varies based on available bandwidth but frequent changes in encoding quality are avoided \cite{Lin2012},
    \item \textit{portfolio management} in which expert advice indicates that certain actions maximize profit but taking an action incurs some cost \cite{Calafiore2008, Das2014, Ballu2019},
    \item \textit{power generation} with dynamic demand as the cheapest generators tend to have high switching costs \cite{Lin2012, Badiei2015},
    \item \textit{contextual sequence prediction} --- used for example in natural language processing and sequence alignment --- where the prediction of the next element of the sequence has to be contextualized (i.e. smoothed) based on its predecessors \cite{Kim2015},
    \item \textit{vertical container scaling} where the per-container resource allocation should depend on load but adaptations lead to a period of unavailability \cite{Rossi2019},
    \item \textit{multi-timescale control} where the linear control constraints act as regularizers \cite{Goel2017},
    \item \textit{smoothed online regression, ridge regression, logistic regression, online maximum likelihood estimation}, and \textit{linear quadratic regulator control} have been shown to be direct instances of Smoothed Online Convex Optimization \cite{Goel2018},
    \item \textit{thermal management} where the operating changes to achieve temperature constraints should be smooth rather than abrupt \cite{Zanini2009},
    \item \textit{electrical vehicle charging} where prices are used to prevent load variations but prices should not change too quickly \cite{Kim2014}, and
    \item \textit{routing in networks} (e.g. automatically switched optimal networks) where there is a cost for establishing a connection \cite{Lin2012}.
\end{itemize}
